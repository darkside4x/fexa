<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to your CSS -->
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script>
        function initClient() {
            gapi.load('client:auth2', () => {
                gapi.auth2.init({
                    client_id: 'YOUR_CLIENT_ID', // Replace with your client ID
                    scope: 'https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/userinfo.email'
                }).then(() => {
                    loadEmails(); // Call the function to load emails
                });
            });
        }

        function loadEmails() {
            gapi.client.gmail.users.messages.list({
                userId: 'me',
                maxResults: 10 // Adjust as needed
            }).then(response => {
                const messages = response.result.messages;
                const emailListDiv = document.getElementById('emailList');
                
                if (messages && messages.length > 0) {
                    messages.forEach(message => {
                        // Fetch email details
                        fetchEmailDetails(message.id);
                    });
                } else {
                    emailListDiv.innerHTML = '<p>No emails found.</p>';
                }
            }).catch(error => {
                console.error("Error loading emails: ", error);
            });
        }

        function fetchEmailDetails(messageId) {
            gapi.client.gmail.users.messages.get({
                userId: 'me',
                id: messageId
            }).then(response => {
                const email = response.result;
                const emailListDiv = document.getElementById('emailList');
                emailListDiv.innerHTML += `<div><strong>${email.snippet}</strong></div>`; // Display email snippet
            }).catch(error => {
                console.error("Error fetching email details: ", error);
            });
        }

        function handleLogout() {
            gapi.auth2.getAuthInstance().signOut().then(() => {
                window.location.href = "index.html"; // Redirect to login page
            });
        }
    </script>
</head>
<body onload="initClient()">
    <h1>Your Emails</h1>
    <div id="emailList"></div>
    <button onclick="handleLogout()">Logout</button>
</body>
</html>
